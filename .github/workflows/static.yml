name: Deploy Docs to GitHub Pages

on:
 push:
  branches:
   - main # è§¦å‘éƒ¨ç½²çš„åˆ†æ”¯

jobs:
 build-deploy:
  runs-on: ubuntu-latest

  steps:
   - name: ğŸš€ Checkout Repository
     uses: actions/checkout@v4

   - name: âš¡ Set up Node.js
     uses: actions/setup-node@v4
     with:
      node-version: 21 # ä½¿ç”¨ Node.js 21.x

   - name: ğŸ“¦ Install Dependencies
     run: npm install # æˆ–è€… yarn install

   - name: Install VuePress
     run: npm install -g vuepress

   - name: Install esbuild
     run: npm install -g esbuild

   - name: Clean install dependencies
     run: |
      rm -rf node_modules package-lock.json
      npm install

   - name: Grant execute permissions to esbuild
     run: chmod +x node_modules/@vuepress/cli/node_modules/@esbuild/linux-x64/bin/esbuild

   - name: Grant execute permissions
     run: chmod +x node_modules/.bin/vuepress

   - name: ğŸ”¨ Build VuePress
     run: npm run docs:build # VuePress é»˜è®¤æ„å»ºå‘½ä»¤

   #  - name: Delete gh-pages branch
   #    run: |
   #     git remote set-url origin https://x-access-token:${{ secrets.GH_PAT }}@github.com/optimibi/docs.git
   #     git push origin --delete gh-pages

   - name: ğŸš€ Deploy to GitHub Pages
     uses: peaceiris/actions-gh-pages@v4
     with:
      github_token: ${{ secrets.GH_PAT }}
      publish_dir: docs/.vuepress/dist
      publish_branch: gh-pages
